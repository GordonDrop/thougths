# JWT

## Как анти-паттерн безопасности

### Кратко о jwt

JWT это стандрат для создания аутен-х сообщения или цифровых подписей.
Описание: https://jwt.io/introduction

### Фейл на уровне спеки

Когда крипто протокол, включающий аут сообщения или подписанные сообщения, позволяет с низкими затратами подделать сообщения, то считается, что протокол скомпроментирован.

Существует два самых распространненых способа подделки JWT:
1. Отправить хедер "alg": "none"
2. Отправить вместо хедера "alg": "HS256", когда приложение подписывает сообщения с помощью RSA public key.

Это фейл на уровне стандарта, потому что стандарт запрещает игнорировать хедер "alg".

Многие реализации интерпретируют спецификацию, как валидацию alg против whitelist. Что не исправляет спецификацию.

Source:
https://paragonie.com/blog/2017/03/jwt-json-web-tokens-is-bad-standard-that-everyone-should-avoid#jwe-foot-gun

Описание уязвимости:
https://auth0.com/blog/critical-vulnerabilities-in-json-web-token-libraries/

### Практики неправильного использования

Интересная дискуссия:
https://github.com/shieldfy/API-Security-Checklist/issues/6#issuecomment-371038523

**use case:** JWT как токен для иддентификации сессий.

1. Вы хотите закодировать какую-то информацию в сессию
2. Вы хотите установить подлинность этой информации
3. Вам НЕ НУЖНА эта информация для устоновления подлинности

НЕТ никакого допольнительного преимущества для использования JWT токенов для аутентификации пользователей.

JWT несет только доп расходы на CPU для декодирования токена на каждый запрос.

Хранение токена в LS как вредоносная практика

Открытость для xss, xss сложнее закрыть и заметить, чем csrf(если хранить session id в куках).

Правильное использование. Межсервеная аутентификация.

Токен подписан, поэтому его удобно использовать для межсерверной авторизации, как single-use authorization token.

Пример: Server A выдает одноразовый токен, чтобы пользователь мог авторизовать и скачать файл с Server B.

В этом случае токен должен:
- иметь малый срок жизни, минуты
- быть одноразовым
- ортогонален сессиям пользователя

Еще больше аргументов против:

http://cryto.net/~joepie91/blog/2016/06/13/stop-using-jwt-for-sessions/
http://cryto.net/~joepie91/blog/2016/06/19/stop-using-jwt-for-sessions-part-2-why-your-solution-doesnt-work/